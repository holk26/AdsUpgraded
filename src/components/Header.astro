---
import Button from './ui/Button.astro';

export interface Props {
  lang?: string;
  t: (key: string) => string;
}

const { lang = 'en', t } = Astro.props;

const navItems = [
  { key: 'nav.features', href: '#features' },
  { key: 'nav.pricing', href: '#pricing' },
  { key: 'nav.about', href: '#about' },
];
---

<header class="fixed top-0 left-0 right-0 z-50 glass-effect border-b border-white/5 shadow-lg">
  <div class="container mx-auto px-4">
    <nav class="flex items-center justify-between py-3 md:py-4 gap-2 md:gap-4" aria-label="Main navigation">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-2 group focus-visible:outline-2 focus-visible:outline-brand-accent rounded-lg flex-shrink-0">
        <svg class="w-7 h-7 md:w-8 md:h-8 transition-transform group-hover:scale-110" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <defs>
            <filter id="glowIndigo" x="-50%" y="-50%" width="200%" height="200%">
              <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
              <feMerge>
                <feMergeNode in="coloredBlur"/>
                <feMergeNode in="SourceGraphic"/>
              </feMerge>
            </filter>
            <filter id="glowCyan" x="-50%" y="-50%" width="200%" height="200%">
              <feGaussianBlur stdDeviation="2.5" result="coloredBlur"/>
              <feMerge>
                <feMergeNode in="coloredBlur"/>
                <feMergeNode in="SourceGraphic"/>
              </feMerge>
            </filter>
            <radialGradient id="indigoGrad" cx="50%" cy="50%">
              <stop offset="0%" style="stop-color:#7B7BFF;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#5D5DFF;stop-opacity:0.8" />
            </radialGradient>
            <radialGradient id="cyanGrad" cx="50%" cy="50%">
              <stop offset="0%" style="stop-color:#00FFDB;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#00FFC2;stop-opacity:0.7" />
            </radialGradient>
          </defs>
          
          <!-- Hexagons with fill and glow -->
          <g filter="url(#glowIndigo)">
            <path d="M60 8 L68 13 L68 23 L60 28 L52 23 L52 13 Z" fill="url(#indigoGrad)" opacity="0.85"/>
          </g>
          <g filter="url(#glowCyan)">
            <path d="M86 28 L94 33 L94 43 L86 48 L78 43 L78 33 Z" fill="url(#cyanGrad)" opacity="0.75"/>
          </g>
          <g filter="url(#glowCyan)">
            <path d="M86 72 L94 77 L94 87 L86 92 L78 87 L78 77 Z" fill="url(#cyanGrad)" opacity="0.75"/>
          </g>
          <g filter="url(#glowIndigo)">
            <path d="M60 92 L68 97 L68 107 L60 112 L52 107 L52 97 Z" fill="url(#indigoGrad)" opacity="0.85"/>
          </g>
          <g filter="url(#glowIndigo)">
            <path d="M34 72 L42 77 L42 87 L34 92 L26 87 L26 77 Z" fill="url(#indigoGrad)" opacity="0.85"/>
          </g>
          <g filter="url(#glowCyan)">
            <path d="M34 28 L42 33 L42 43 L34 48 L26 43 L26 33 Z" fill="url(#cyanGrad)" opacity="0.75"/>
          </g>
          
          <!-- Connection lines -->
          <line x1="60" y1="28" x2="60" y2="40" stroke="#5D5DFF" stroke-width="1.5" stroke-dasharray="2,3" opacity="0.6"/>
          <line x1="78" y1="43" x2="68" y2="50" stroke="#00FFC2" stroke-width="1.5" stroke-dasharray="2,3" opacity="0.5"/>
          <line x1="78" y1="77" x2="68" y2="70" stroke="#00FFC2" stroke-width="1.5" stroke-dasharray="2,3" opacity="0.5"/>
          <line x1="60" y1="92" x2="60" y2="80" stroke="#5D5DFF" stroke-width="1.5" stroke-dasharray="2,3" opacity="0.6"/>
          <line x1="42" y1="77" x2="52" y2="70" stroke="#5D5DFF" stroke-width="1.5" stroke-dasharray="2,3" opacity="0.6"/>
          <line x1="42" y1="43" x2="52" y2="50" stroke="#00FFC2" stroke-width="1.5" stroke-dasharray="2,3" opacity="0.5"/>
          
          <!-- Central white circle -->
          <circle cx="60" cy="60" r="18" fill="#F2F2F2" opacity="0.98"/>
          <circle cx="60" cy="60" r="18" fill="none" stroke="#FFFFFF" stroke-width="2" opacity="0.5"/>
          
          <!-- Inner ring -->
          <circle cx="60" cy="60" r="22" fill="none" stroke="#5D5DFF" stroke-width="1.5" opacity="0.3"/>
          
          <!-- Connection nodes -->
          <circle cx="60" cy="8" r="2.5" fill="#5D5DFF" filter="url(#glowIndigo)"/>
          <circle cx="86" cy="28" r="2.5" fill="#00FFC2" filter="url(#glowCyan)"/>
          <circle cx="86" cy="92" r="2.5" fill="#00FFC2" filter="url(#glowCyan)"/>
          <circle cx="60" cy="112" r="2.5" fill="#5D5DFF" filter="url(#glowIndigo)"/>
          <circle cx="34" cy="92" r="2.5" fill="#5D5DFF" filter="url(#glowIndigo)"/>
          <circle cx="34" cy="28" r="2.5" fill="#00FFC2" filter="url(#glowCyan)"/>
        </svg>
        <span class="text-base md:text-xl font-bold text-color-accent hidden xs:inline" style="letter-spacing: 0.05em;">NYXOK</span>
        <span class="text-base md:text-xl font-bold text-color-accent xs:hidden" style="letter-spacing: 0.05em;">NYXOK</span>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center gap-8" id="desktop-nav">
        {navItems.map((item) => (
          <a 
            href={item.href}
            data-nav-link
            data-nav-key={item.key}
            class="text-text-body hover:text-color-secondary transition-colors font-medium focus-visible:outline-2 focus-visible:outline-color-accent rounded px-2 py-1"
          >
            {t(item.key)}
          </a>
        ))}
      </div>

      <!-- Mobile Navigation - Simple -->
      <nav class="fixed inset-0 z-[60] bg-background-dark hidden transition-all duration-300" id="mobile-nav" aria-hidden="true" role="dialog" aria-label="Mobile navigation">
        <div class="flex flex-col h-full p-6">
          <!-- Navigation Links -->
          <div class="flex-1 flex flex-col justify-center gap-6">
            {navItems.map((item) => (
              <a
                href={item.href}
                class="text-2xl font-bold text-white hover:text-cyan-400 transition-colors"
              >
                {t(item.key)}
              </a>
            ))}
          </div>

          <!-- Language & CTA -->
          <div class="flex flex-col gap-6 pb-6">
            <div class="flex gap-4" role="group" aria-label="Language selection">
              <a
                href="/"
                class={`px-6 py-3 rounded-lg text-lg font-medium transition-all ${lang === 'en' ? 'bg-cyan-400 text-black' : 'text-white border border-white/20 hover:border-cyan-400'}`}
                aria-label="Switch to English"
              >
                EN
              </a>
              <a
                href="/es"
                class={`px-6 py-3 rounded-lg text-lg font-medium transition-all ${lang === 'es' ? 'bg-cyan-400 text-black' : 'text-white border border-white/20 hover:border-cyan-400'}`}
                aria-label="Cambiar a Español"
              >
                ES
              </a>
            </div>
            <a
              href="#demo"
              class="px-8 py-4 bg-gradient-to-r from-cyan-400 to-blue-500 text-black font-bold rounded-lg hover:shadow-lg hover:shadow-cyan-400/50 transition-all duration-300 text-center"
            >
              {t('nav.demo')}
            </a>
          </div>
        </div>
      </nav>

      <!-- Actions -->
      <div class="flex items-center gap-1.5 md:gap-3">
        <!-- Language Selector - Desktop -->
        <div class="hidden md:flex gap-1 md:gap-2" role="group" aria-label="Language selection">
          <a 
            href="/" 
            class={`px-2 md:px-3 py-1 md:py-1.5 rounded-md text-sm font-medium transition-all ${lang === 'en' ? 'bg-color-accent text-white shadow-sm' : 'text-text-muted hover:text-text-heading hover:bg-color-surface'}`}
            aria-label="Switch to English"
            aria-current={lang === 'en' ? 'true' : undefined}
          >
            EN
          </a>
          <a 
            href="/es" 
            class={`px-2 md:px-3 py-1 md:py-1.5 rounded-md text-sm font-medium transition-all ${lang === 'es' ? 'bg-color-accent text-white shadow-sm' : 'text-text-muted hover:text-text-heading hover:bg-color-surface'}`}
            aria-label="Cambiar a Español"
            aria-current={lang === 'es' ? 'true' : undefined}
          >
            ES
          </a>
        </div>
        <Button variant="primary" size="sm" href="#demo" ariaLabel={t('nav.demo')} class="hidden md:inline-flex text-xs md:text-sm px-3 md:px-4">
          <span class="hidden sm:inline">{t('nav.demo')}</span>
          <span class="sm:hidden">Demo</span>
        </Button>
        
        <!-- Hamburger Button -->
        <button
          id="hamburger-btn"
          class="md:hidden flex items-center justify-center w-10 h-10 rounded-lg hover:bg-white/5 transition-colors focus-visible:outline-2 focus-visible:outline-brand-accent"
          aria-label="Toggle navigation menu"
          aria-expanded="false"
          aria-controls="mobile-nav"
          type="button"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path id="hamburger-top" class="transition-all duration-300 ease-in-out origin-center" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16" />
            <path id="hamburger-middle" class="transition-all duration-300 ease-in-out" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h16" />
            <path id="hamburger-bottom" class="transition-all duration-300 ease-in-out origin-center" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 18h16" />
          </svg>
        </button>
      </div>
    </nav>
  </div>
</header>

<!-- Skip to main content link for accessibility -->
<a 
  href="#main-content" 
  class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-brand-primary text-white px-4 py-2 rounded-lg z-[100] focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-accent"
>
  Skip to main content
</a>

<script>
  // Simple Hamburger Menu
  class SimpleMenu {
    private isOpen = false;
    private mobileNav: HTMLElement;
    private hamburgerBtn: HTMLButtonElement;
    private hamburgerTop: SVGPathElement;
    private hamburgerMiddle: SVGPathElement;
    private hamburgerBottom: SVGPathElement;
    private scrollY = 0;

    constructor() {
      this.mobileNav = document.getElementById('mobile-nav') as HTMLElement;
      this.hamburgerBtn = document.getElementById('hamburger-btn') as HTMLButtonElement;
      this.hamburgerTop = document.getElementById('hamburger-top') as unknown as SVGPathElement;
      this.hamburgerMiddle = document.getElementById('hamburger-middle') as unknown as SVGPathElement;
      this.hamburgerBottom = document.getElementById('hamburger-bottom') as unknown as SVGPathElement;

      this.init();
    }

    private init() {
      this.hamburgerBtn.addEventListener('click', () => this.toggle());
      
      // Close on navigation link click
      const navLinks = this.mobileNav.querySelectorAll('a');
      navLinks.forEach(link => {
        link.addEventListener('click', () => this.close());
      });

      // Close on Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && this.isOpen) {
          this.close();
        }
      });
    }

    private toggle() {
      if (this.isOpen) {
        this.close();
      } else {
        this.open();
      }
    }

    private open() {
      this.isOpen = true;
      
      // Update ARIA
      this.hamburgerBtn.setAttribute('aria-expanded', 'true');
      this.mobileNav.setAttribute('aria-hidden', 'false');

      // Transform hamburger to X
      this.hamburgerTop.classList.add('translate-y-[6px]', 'rotate-45');
      this.hamburgerMiddle.classList.add('opacity-0', 'scale-x-0');
      this.hamburgerBottom.classList.add('-translate-y-[6px]', '-rotate-45');

      // Preserve scroll position
      this.scrollY = window.scrollY;
      document.body.style.overflow = 'hidden';
      document.body.style.position = 'fixed';
      document.body.style.top = `-${this.scrollY}px`;
      document.body.style.width = '100%';

      // Show mobile nav
      this.mobileNav.classList.remove('hidden');
      this.mobileNav.classList.add('block');
    }

    private close() {
      if (!this.isOpen) return;
      
      this.isOpen = false;

      // Update ARIA
      this.hamburgerBtn.setAttribute('aria-expanded', 'false');
      this.mobileNav.setAttribute('aria-hidden', 'true');

      // Transform X back to hamburger
      this.hamburgerTop.classList.remove('translate-y-[6px]', 'rotate-45');
      this.hamburgerMiddle.classList.remove('opacity-0', 'scale-x-0');
      this.hamburgerBottom.classList.remove('-translate-y-[6px]', '-rotate-45');

      // Hide mobile nav
      this.mobileNav.classList.add('hidden');
      this.mobileNav.classList.remove('block');

      // Restore scroll
      document.body.style.overflow = '';
      document.body.style.position = '';
      document.body.style.top = '';
      document.body.style.width = '';
      window.scrollTo(0, this.scrollY);

      // Restore focus
      this.hamburgerBtn.focus();
    }
  }

  // Initialize
  if (typeof window !== 'undefined') {
    document.addEventListener('DOMContentLoaded', () => {
      new SimpleMenu();
    });
  }
</script>
