---
import Layout from '../layouts/Layout.astro';
---

<Layout 
  title="LeadFlow Engine - Interactive Demo"
  description="Interactive mind map showing the flow from Facebook to Core to Dashboard"
>
  <div class="min-h-screen bg-bg-surface py-12 px-4">
    <div class="max-w-6xl mx-auto">
      
      <!-- Header -->
      <header class="text-center mb-12">
        <h1 class="font-heading text-text-heading mb-4">LeadFlow Engine Interactive Demo</h1>
        <p class="text-text-body text-lg max-w-2xl mx-auto">
          Explore how leads flow from Facebook through our Core system to your Dashboard
        </p>
      </header>

      <!-- Interactive Mind Map Container -->
      <div class="bg-white rounded-saas shadow-lg border border-brand-border p-8 relative overflow-hidden">
        <svg id="mindmap" class="w-full" style="min-height: 600px;" viewBox="0 0 1000 600" preserveAspectRatio="xMidYMid meet">
          <defs>
            <!-- Gradient for connections -->
            <linearGradient id="connectionGradient" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" style="stop-color:var(--color-accent);stop-opacity:1" />
              <stop offset="100%" style="stop-color:var(--color-secondary);stop-opacity:1" />
            </linearGradient>
            
            <!-- Animated gradient for active state -->
            <linearGradient id="activeGradient" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" style="stop-color:var(--color-accent);stop-opacity:1">
                <animate attributeName="offset" values="0;1;0" dur="2s" repeatCount="indefinite" />
              </stop>
              <stop offset="50%" style="stop-color:var(--color-secondary);stop-opacity:1">
                <animate attributeName="offset" values="0.5;1;0.5" dur="2s" repeatCount="indefinite" />
              </stop>
              <stop offset="100%" style="stop-color:var(--color-primary);stop-opacity:1">
                <animate attributeName="offset" values="1;0;1" dur="2s" repeatCount="indefinite" />
              </stop>
            </linearGradient>

            <!-- Drop shadow filter -->
            <filter id="dropShadow" x="-50%" y="-50%" width="200%" height="200%">
              <feGaussianBlur in="SourceAlpha" stdDeviation="3"/>
              <feOffset dx="0" dy="2" result="offsetblur"/>
              <feComponentTransfer>
                <feFuncA type="linear" slope="0.3"/>
              </feComponentTransfer>
              <feMerge>
                <feMergeNode/>
                <feMergeNode in="SourceGraphic"/>
              </feMerge>
            </filter>
          </defs>

          <!-- Connection Lines -->
          <g id="connections">
            <!-- Facebook to Core -->
            <path id="line-fb-core" 
                  d="M 250 300 L 500 300" 
                  stroke="url(#connectionGradient)" 
                  stroke-width="4" 
                  fill="none" 
                  stroke-dasharray="10 5"
                  class="connection-line">
              <animate attributeName="stroke-dashoffset" from="15" to="0" dur="1s" repeatCount="indefinite" />
            </path>
            
            <!-- Core to Dashboard -->
            <path id="line-core-dashboard" 
                  d="M 500 300 L 750 300" 
                  stroke="url(#connectionGradient)" 
                  stroke-width="4" 
                  fill="none" 
                  stroke-dasharray="10 5"
                  class="connection-line">
              <animate attributeName="stroke-dashoffset" from="15" to="0" dur="1s" repeatCount="indefinite" />
            </path>
          </g>

          <!-- Nodes -->
          <!-- Facebook Node -->
          <g id="node-facebook" class="node" data-node="facebook" style="cursor: pointer;">
            <circle cx="150" cy="300" r="70" fill="#1877F2" filter="url(#dropShadow)" class="node-circle"/>
            <circle cx="150" cy="300" r="74" fill="none" stroke="#1877F2" stroke-width="2" opacity="0.3" class="node-ring">
              <animate attributeName="r" values="74;80;74" dur="2s" repeatCount="indefinite" />
              <animate attributeName="opacity" values="0.3;0;0.3" dur="2s" repeatCount="indefinite" />
            </circle>
            <!-- Facebook Icon -->
            <text x="150" y="315" text-anchor="middle" fill="white" font-size="48" font-weight="bold">f</text>
            <text x="150" y="390" text-anchor="middle" fill="var(--text-heading)" font-size="18" font-weight="600">Facebook</text>
            <text x="150" y="410" text-anchor="middle" fill="var(--text-body)" font-size="14">Lead Source</text>
          </g>

          <!-- Core Node (Central Hub) -->
          <g id="node-core" class="node" data-node="core" style="cursor: pointer;">
            <circle cx="500" cy="300" r="80" fill="var(--color-primary)" filter="url(#dropShadow)" class="node-circle"/>
            <circle cx="500" cy="300" r="84" fill="none" stroke="var(--color-accent)" stroke-width="2" opacity="0.3" class="node-ring">
              <animate attributeName="r" values="84;90;84" dur="2s" repeatCount="indefinite" />
              <animate attributeName="opacity" values="0.3;0;0.3" dur="2s" repeatCount="indefinite" />
            </circle>
            <!-- Core Icon (Gear/Cog) -->
            <g transform="translate(500, 300)">
              <path d="M 0,-30 L 5,-35 L 10,-30 L 10,-20 L 5,-15 L 0,-20 Z M 21,-21 L 28,-23 L 32,-18 L 28,-10 L 21,-8 L 18,-13 Z M 21,21 L 23,28 L 18,32 L 10,28 L 8,21 L 13,18 Z M -21,21 L -28,23 L -32,18 L -28,10 L -21,8 L -18,13 Z M -21,-21 L -23,-28 L -18,-32 L -10,-28 L -8,-21 L -13,-18 Z" 
                    fill="white" opacity="0.3"/>
              <circle cx="0" cy="0" r="15" fill="none" stroke="white" stroke-width="3"/>
              <circle cx="0" cy="0" r="8" fill="white"/>
            </g>
            <text x="500" y="400" text-anchor="middle" fill="var(--text-heading)" font-size="18" font-weight="600">Core Engine</text>
            <text x="500" y="420" text-anchor="middle" fill="var(--text-body)" font-size="14">Processing Hub</text>
          </g>

          <!-- Dashboard Node -->
          <g id="node-dashboard" class="node" data-node="dashboard" style="cursor: pointer;">
            <circle cx="850" cy="300" r="70" fill="var(--color-secondary)" filter="url(#dropShadow)" class="node-circle"/>
            <circle cx="850" cy="300" r="74" fill="none" stroke="var(--color-secondary)" stroke-width="2" opacity="0.3" class="node-ring">
              <animate attributeName="r" values="74;80;74" dur="2s" repeatCount="indefinite" />
              <animate attributeName="opacity" values="0.3;0;0.3" dur="2s" repeatCount="indefinite" />
            </circle>
            <!-- Dashboard Icon (Chart) -->
            <g transform="translate(850, 300)">
              <rect x="-25" y="-20" width="10" height="35" fill="white" rx="2"/>
              <rect x="-8" y="-28" width="10" height="43" fill="white" rx="2"/>
              <rect x="9" y="-15" width="10" height="30" fill="white" rx="2"/>
            </g>
            <text x="850" y="390" text-anchor="middle" fill="var(--text-heading)" font-size="18" font-weight="600">Dashboard</text>
            <text x="850" y="410" text-anchor="middle" fill="var(--text-body)" font-size="14">Analytics & Insights</text>
          </g>
        </svg>

        <!-- Info Panel -->
        <div id="info-panel" class="mt-8 p-6 bg-color-surface rounded-saas border border-brand-border">
          <h3 class="font-heading text-text-heading text-xl mb-4">Click on any node to learn more</h3>
          <div id="node-info" class="text-text-body">
            <p class="mb-3"><strong>Interactive Mind Map:</strong> This visualization shows how LeadFlow Engine connects your marketing channels to actionable insights.</p>
            <ul class="list-disc list-inside space-y-2">
              <li><strong>Facebook:</strong> Your lead generation source</li>
              <li><strong>Core Engine:</strong> Processes, normalizes, and enriches lead data</li>
              <li><strong>Dashboard:</strong> Real-time analytics and ROI tracking</li>
            </ul>
          </div>
        </div>
      </div>

    </div>
  </div>

  <style>
    .node {
      transition: all 0.3s ease;
    }

    .node:hover .node-circle {
      filter: url(#dropShadow) brightness(1.1);
    }

    .node:hover .node-ring {
      stroke-width: 3;
      opacity: 0.6 !important;
    }

    .connection-line {
      transition: stroke-width 0.3s ease;
    }

    .node.active .node-circle {
      filter: url(#dropShadow) brightness(1.2);
    }

    .node.active .node-ring {
      stroke-width: 4;
    }

    #info-panel {
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>

  <script>
    // Interactive functionality
    const nodes = document.querySelectorAll('.node');
    const infoPanel = document.getElementById('node-info');

    const nodeInfo = {
      facebook: {
        title: 'Facebook Lead Source',
        description: 'Capture leads directly from your Facebook campaigns with full UTM tracking.',
        features: [
          'Automatic lead capture from Facebook Ads',
          'Complete UTM parameter tracking',
          'Real-time lead notification',
          'Instagram integration included',
          'Track campaign performance'
        ]
      },
      core: {
        title: 'Core Processing Engine',
        description: 'The heart of LeadFlow Engine - where all the magic happens.',
        features: [
          'Instant data normalization and cleaning',
          'Automatic lead enrichment',
          'Duplicate detection and merging',
          'Smart routing to appropriate teams',
          'Real-time CRM synchronization',
          'Advanced UTM attribution'
        ]
      },
      dashboard: {
        title: 'Analytics Dashboard',
        description: 'Get actionable insights and track your ROI in real-time.',
        features: [
          'Real-time lead tracking',
          'Campaign ROI analysis',
          'Lead source attribution',
          'Conversion funnel visualization',
          'Custom reporting',
          'Export to CSV/PDF'
        ]
      }
    };

    nodes.forEach(node => {
      node.addEventListener('click', function(e) {
        e.preventDefault();
        
        // Remove active class from all nodes
        nodes.forEach(n => n.classList.remove('active'));
        
        // Add active class to clicked node
        this.classList.add('active');
        
        // Update info panel
        const nodeType = this.getAttribute('data-node');
        const info = nodeInfo[nodeType];
        
        if (info && infoPanel) {
          infoPanel.innerHTML = `
            <h3 class="font-heading text-text-heading text-xl mb-3">${info.title}</h3>
            <p class="text-text-body mb-4">${info.description}</p>
            <h4 class="font-heading text-text-heading text-base mb-2">Key Features:</h4>
            <ul class="list-disc list-inside space-y-2 text-text-body">
              ${info.features.map((feature: string) => `<li>${feature}</li>`).join('')}
            </ul>
          `;
        }
      });

      // Add hover effect to connections
      node.addEventListener('mouseenter', function() {
        const nodeType = this.getAttribute('data-node');
        if (nodeType === 'facebook') {
          document.getElementById('line-fb-core')?.setAttribute('stroke-width', '6');
        } else if (nodeType === 'core') {
          document.getElementById('line-fb-core')?.setAttribute('stroke-width', '6');
          document.getElementById('line-core-dashboard')?.setAttribute('stroke-width', '6');
        } else if (nodeType === 'dashboard') {
          document.getElementById('line-core-dashboard')?.setAttribute('stroke-width', '6');
        }
      });

      node.addEventListener('mouseleave', function() {
        document.querySelectorAll('.connection-line').forEach(line => {
          line.setAttribute('stroke-width', '4');
        });
      });
    });
  </script>
</Layout>
